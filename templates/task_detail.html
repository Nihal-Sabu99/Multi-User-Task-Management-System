<!DOCTYPE html>
<html>
<head>
    <title>Task Management System - Task Details</title>
    <link rel="stylesheet" href="/static/stylesss.css">
</head>
<body>
    <div class="navbar">
        <div class="logo">Task Management System</div>
        <a class="back-dashboard" href="/board/{{ board.id }}">‚Üê Back to Board</a>
    </div>
    
    <main>
        <div class="task-details-box">    
            <h2>Task: {{ task.title }}</h2>    
            <h3>Description:</h3>
            <p>{{ task.description }}</p>
            <h3>Status:</h3>
            <form action="/board/{{ board.id }}/task/{{ task.id }}/complete" method="post" class="status-form">
                <label class="checkbox-label">
                    <input type="checkbox" onchange="this.form.submit()" {% if task.completed %}checked{% endif %}>
                    <span>{{ 'Completed' if task.completed else 'In Progress' }}</span>
                </label>
            </form>
            <p>Due: {{ task.due_date }}</p>
            {% if task.completed and task.completed_at %}
                <p>Completed at: {{ task.completed_at.strftime('%Y-%m-%d %H:%M:%S') if task.completed_at.strftime else task.completed_at }}</p>
            {% endif %}
            <h3>Assignees:</h3>
            {% if task.assignees and task.assignees|length > 0 %}
                <ul class="assign-list">
                    {% for assignee in task.assignees %}
                        <li>
                            {{ assignee }}
                            {% if is_creator %}
                                <form action="/board/{{ board.id }}/task/{{ task.id }}/unassign" method="post" class="inline-form">
                                    <input type="hidden" name="assignee" value="{{ assignee }}">
                                    <button type="submit" class="small-button">Unassign</button>
                                </form>
                            {% endif %}
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p class="no-assignees">No assignees</p>
            {% endif %}
            {% if is_creator %}
                <h3>Assign to:</h3>
                <form action="/board/{{ board.id }}/task/{{ task.id }}/assign" method="post" class="assign-form">
                    <select name="assignee" required>
                        <option value="" disabled selected>-- Select User --</option>
                        {% for member in members %}
                            {% if member not in task.assignees %}
                                <option value="{{ member }}">{{ member }}</option>
                            {% endif %}
                        {% endfor %}
                    </select>
                    <button type="submit" class="button">Assign</button>
                </form>
            {% endif %}
            <div class="action-btn">
                <a href="/board/{{ board.id }}/task/{{ task.id }}/edit" class="button danger">Edit Task</a>
                <form action="/board/{{ board.id }}/task/{{ task.id }}/delete" method="post" class="inline-form">
                    <button type="submit" class="button danger" onclick="return confirm('Are you sure you want to delete this task?');">Delete Task</button>
                </form>
            </div>
        </div>
    </main>
    <script type="module" src="/static/firebase-login.js"></script>
</body>
</html>